<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Türkiye ezan vakitleri, namaz saatleri">
    <title>Ezan Saatleri</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body { 
            font-family: Arial, sans-serif; 
            text-align: center; 
            background-image: url('https://source.unsplash.com/random/1920x1080/?mosque'); 
            background-size: cover; 
            color: #fff; 
            padding: 20px; 
        }
        h1 { color: #fff; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
        .container { background: rgba(255,255,255,0.9); padding: 20px; border-radius: 10px; }
        .error { color: red; }
        @media (max-width: 600px) { table { width: 100%; } }
    </style>
</head>
<body>
    <div class="container">
        <h1>Ezan Saatleri</h1>
        <p>Şehir seçin veya konumu otomatik al:</p>
        <select id="city" class="form-select mb-3">
            <option value="Istanbul">İstanbul</option>
            <option value="Ankara">Ankara</option>
            <option value="Izmir">İzmir</option>
            <option value="Adana">Adana</option>
            <option value="Bursa">Bursa</option>
        </select>
        <button class="btn btn-primary" onclick="getPrayerTimes()">Vakitleri Getir</button>
        <button class="btn btn-secondary" onclick="getPrayerTimesByLocation()">Konum ile Getir</button>
        <button class="btn btn-info" onclick="getMonthlyCalendar()">Aylık Takvim</button>
        <div id="qibla" class="mt-3"></div>
        <div id="result" class="mt-3"></div>
        <div id="error" class="error"></div>
    </div>

    <script>
        async function getPrayerTimes(city = 'Istanbul', country = 'Turkey') {
            const method = 5;
            if (!city) {
                document.getElementById('error').innerText = 'Lütfen bir şehir seçin!';
                return;
            }

            const apiUrl = `http://api.aladhan.com/v1/timingsByCity?city=${encodeURIComponent(city)}&country=${encodeURIComponent(country)}&method=${method}`;
            const url = `https://api.allorigins.win/raw?url=${encodeURIComponent(apiUrl)}`;

            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error('API hatası: ' + response.status);
                const data = await response.json();
                const timings = data.data.timings;

                let table = '<table class="table table-striped"><tr><th>Vakit</th><th>Saat</th></tr>';
                table += `<tr><td>İmsak</td><td>${timings.Imsak}</td></tr>`;
                table += `<tr><td>Sabah</td><td>${timings.Fajr}</td></tr>`;
                table += `<tr><td>Öğle</td><td>${timings.Dhuhr}</td></tr>`;
                table += `<tr><td>İkindi</td><td>${timings.Asr}</td></tr>`;
                table += `<tr><td>Akşam</td><td>${timings.Maghrib}</td></tr>`;
                table += `<tr><td>Yatsı</td><td>${timings.Isha}</td></tr>`;
                table += '</table>';

                document.getElementById('result').innerHTML = table;
                document.getElementById('error').innerText = '';
            } catch (error) {
                console.error('API Hatası Detayı:', error); // Konsola detay yazdır
                document.getElementById('error').innerText = 'Hata: Şehir bulunamadı veya bağlantı sorunu. Konsolu kontrol edin (F12).';
            }
        }

        async function getPrayerTimesByLocation() {
            if (!navigator.geolocation) {
                document.getElementById('error').innerText = 'Konum servisi desteklenmiyor!';
                return;
            }

            navigator.geolocation.getCurrentPosition(async (position) => {
                const { latitude, longitude } = position.coords;
                const method = 5;
                const apiUrl = `http://api.aladhan.com/v1/timings?latitude=${latitude}&longitude=${longitude}&method=${method}`;
                const url = `https://api.allorigins.win/raw?url=${encodeURIComponent(apiUrl)}`;

                try {
                    const response = await fetch(url);
                    if (!response.ok) throw new Error('API hatası: ' + response.status);
                    const data = await response.json();
                    const timings = data.data.timings;

                    let table = '<table class="table table-striped"><tr><th>Vakit</th><th>Saat</th></tr>';
                    table += `<tr><td>İmsak</td><td>${timings.Imsak}</td></tr>`;
                    table += `<tr><td>Sabah</td><td>${timings.Fajr}</td></tr>`;
                    table += `<tr><td>Öğle</td><td>${timings.Dhuhr}</td></tr>`;
                    table += `<tr><td>İkindi</td><td>${timings.Asr}</td></tr>`;
                    table += `<tr><td>Akşam</td><td>${timings.Maghrib}</td></tr>`;
                    table += `<tr><td>Yatsı</td><td>${timings.Isha}</td></tr>`;
                    table += '</table>';

                    document.getElementById('result').innerHTML = table;
                    document.getElementById('error').innerText = 'Konum: ' + latitude.toFixed(2) + ', ' + longitude.toFixed(2);
                    calculateQibla(latitude, longitude);
                } catch (error) {
                    console.error('Konum API Hatası:', error);
                    document.getElementById('error').innerText = 'Hata: Konum bazlı vakitler alınamadı. Konsolu kontrol edin.';
                }
            }, () => {
                document.getElementById('error').innerText = 'Konum izni reddedildi!';
            });
        }

        async function getMonthlyCalendar() {
            const city = document.getElementById('city').value;
            const month = new Date().getMonth() + 1;
            const year = new Date().getFullYear();
            const apiUrl = `http://api.aladhan.com/v1/calendarByCity?city=${city}&country=Turkey&method=5&month=${month}&year=${year}`;
            const url = `https://api.allorigins.win/raw?url=${encodeURIComponent(apiUrl)}`;

            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error('API hatası: ' + response.status);
                const data = await response.json();
                let table = '<table class="table table-striped"><tr><th>Tarih</th><th>İmsak</th><th>Sabah</th><th>Öğle</th><th>İkindi</th><th>Akşam</th><th>Yatsı</th></tr>';
                data.data.forEach(day => {
                    table += `<tr><td>${day.date.readable}</td><td>${day.timings.Imsak}</td><td>${day.timings.Fajr}</td><td>${day.timings.Dhuhr}</td><td>${day.timings.Asr}</td><td>${day.timings.Maghrib}</td><td>${day.timings.Isha}</td></tr>`;
                });
                table += '</table>';
                document.getElementById('result').innerHTML = table;
                document.getElementById('error').innerText = '';
            } catch (error) {
                console.error('Takvim API Hatası:', error);
                document.getElementById('error').innerText = 'Hata: Takvim alınamadı. Konsolu kontrol edin.';
            }
        }

        function calculateQibla(lat, lon) {
            const kaabaLat = 21.4225, kaabaLon = 39.8262;
            const phiK = kaabaLat * Math.PI / 180;
            const lambdaK = kaabaLon * Math.PI / 180;
            const phi = lat * Math.PI / 180;
            const lambda = lon * Math.PI / 180;
            let qibla = Math.atan2(Math.sin(lambdaK - lambda), Math.cos(phi) * Math.tan(phiK) - Math.sin(phi) * Math.cos(lambdaK - lambda)) * 180 / Math.PI;
            if (qibla < 0) qibla += 360; // 0-360 arası yap
            document.getElementById('qibla').innerHTML = `<strong>Qibla Yönü: ${qibla.toFixed(2)}° (Kuzeyden saat yönünde)</strong>`;
        }

        window.onload = () => {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition((position) => {
                    getPrayerTimesByLocation();
                }, () => {
                    getPrayerTimes();
                });
            } else {
                getPrayerTimes();
            }
        };
    </script>
</body>
</html>